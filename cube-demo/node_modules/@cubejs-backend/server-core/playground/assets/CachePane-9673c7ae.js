import{j as e,Q as P,F as N,a as y,T as c,l as f,P as s,C as R,n as T}from"./index-f32c771c.js";import{s as b}from"./sqlFormatter-f7d64f52.js";const S=({query:x})=>e(P,{loadSql:!0,query:{...x,renewQuery:!0},render:({sqlQuery:l,resultSet:d,error:u})=>{var g;if(u)return e(N,{error:u});const K=(d==null?void 0:d.serialize())||{},r=l==null?void 0:l.rawQuery(),t=(g=K.loadResponse)==null?void 0:g.results[0];return y(c,{defaultActiveKey:"refreshKeys",tabBarExtraContent:y("span",{children:["Last Refresh Time:Â ",e("b",{children:t==null?void 0:t.lastRefreshTime})]}),children:[e(c.TabPane,{tab:"Refresh Keys",children:e(f,{loading:!l,pagination:!1,scroll:{x:!0},columns:[{title:"Refresh Key SQL",key:"refreshKey",render:(a,n)=>e(s,{code:b.format(n[0])})},{title:"Value",key:"value",render:(a,n)=>e(s,{code:(t==null?void 0:t.refreshKeyValues)&&r&&JSON.stringify(t.refreshKeyValues[r.cacheKeyQueries.indexOf(n)],null,2)})}],dataSource:r==null?void 0:r.cacheKeyQueries})},"refreshKeys"),e(c.TabPane,{tab:"Pre-aggregations",children:e(f,{loading:!l,pagination:!1,scroll:{x:!0},columns:[{title:"Table Name",key:"tableName",dataIndex:"tableName",render:a=>e("b",{children:a})},{title:"Refresh Key SQL",key:"refreshKey",dataIndex:"invalidateKeyQueries",render:a=>a.map(n=>e(s,{code:b.format(n[0])},n[0]))},{title:"Refresh Key Value",key:"value",render:(a,n)=>{var h,m;let i=(m=(h=t==null?void 0:t.usedPreAggregations)==null?void 0:h[n.tableName])==null?void 0:m.refreshKeyValues;return Array.isArray(i)&&(i=i.reduce((o,p)=>o.concat(p),[])),i==null?void 0:i.map(o=>e(s,{code:JSON.stringify(o,null,2)},JSON.stringify(o)))}}],dataSource:r==null?void 0:r.preAggregations})},"preAggregations"),e(c.TabPane,{tab:"Rollup Match Results",children:e(f,{loading:!l,pagination:!1,scroll:{x:!0},columns:[{title:"Rollup Name",key:"name",dataIndex:"name",render:a=>e("b",{children:a})},{title:"Rollup Definition",key:"rollup",dataIndex:"references",render:a=>e(s,{code:JSON.stringify(a,null,2)})},{title:"Can Be Used",key:"canUsePreAggregation",dataIndex:"canUsePreAggregation",render:a=>a?e(R,{style:{color:"#52c41a",fontSize:"2em"}}):e(T,{style:{color:"#c2371b",fontSize:"2em"}})}],dataSource:r==null?void 0:r.rollupMatchResults})},"rollupMatchResults")]})}});export{S as default};

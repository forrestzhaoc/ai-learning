======================================================================
TabTransformer 糖尿病预测模型训练
======================================================================

加载数据...
训练集形状: (700000, 26)

分割训练集和验证集...
训练集: 560000
验证集: 140000

使用设备: cpu

使用全部训练数据: 560000 样本
这将需要更长的训练时间，但可能获得更好的性能
======================================================================
训练TabTransformer模型
======================================================================

训练集大小: 560000
验证集大小: 140000

准备数据...
拟合Transformer数据处理器...
分类特征 (13): ['gender', 'ethnicity', 'education_level', 'income_level', 'smoking_status']...
数值特征 (22): ['age', 'alcohol_consumption_per_week', 'physical_activity_minutes_per_week', 'diet_score', 'sleep_hours_per_day']...
分类特征基数: [4, 6, 5, 6, 4, 5, 5, 6, 3, 3, 3, 3, 3]
处理器拟合完成!

模型参数:
  数值特征数: 22
  分类特征数: 13
  分类特征基数: [4, 6, 5, 6, 4, 5, 5, 6, 3, 3, 3, 3, 3]

模型参数数量:
  总参数: 521,473
  可训练参数: 521,473

开始训练 (20 epochs)...
设备: cpu
----------------------------------------------------------------------
Epoch 1/20
  Train - Loss: 0.6094, Acc: 0.6582, AUC: 0.6848, F1: 0.7580
  Val   - Loss: 0.6106, Acc: 0.6561, AUC: 0.6943, F1: 0.7313
  ✓ 新的最佳模型 (AUC: 0.6943)
----------------------------------------------------------------------
Epoch 2/20
  Train - Loss: 0.6060, Acc: 0.6613, AUC: 0.6905, F1: 0.7586
  Val   - Loss: 0.6036, Acc: 0.6640, AUC: 0.6947, F1: 0.7632
  ✓ 新的最佳模型 (AUC: 0.6947)
----------------------------------------------------------------------
Epoch 3/20
  Train - Loss: 0.6051, Acc: 0.6624, AUC: 0.6919, F1: 0.7591
  Val   - Loss: 0.6048, Acc: 0.6617, AUC: 0.6953, F1: 0.7700
  ✓ 新的最佳模型 (AUC: 0.6953)
----------------------------------------------------------------------
Epoch 4/20
  Train - Loss: 0.6046, Acc: 0.6625, AUC: 0.6925, F1: 0.7595
  Val   - Loss: 0.6073, Acc: 0.6590, AUC: 0.6949, F1: 0.7722
----------------------------------------------------------------------
Epoch 5/20
  Train - Loss: 0.6043, Acc: 0.6630, AUC: 0.6929, F1: 0.7601
  Val   - Loss: 0.6044, Acc: 0.6640, AUC: 0.6948, F1: 0.7645
----------------------------------------------------------------------
Epoch 6/20
  Train - Loss: 0.6039, Acc: 0.6632, AUC: 0.6935, F1: 0.7597
  Val   - Loss: 0.6035, Acc: 0.6643, AUC: 0.6955, F1: 0.7604
  ✓ 新的最佳模型 (AUC: 0.6955)
----------------------------------------------------------------------
Epoch 7/20
  Train - Loss: 0.6036, Acc: 0.6636, AUC: 0.6939, F1: 0.7602
  Val   - Loss: 0.6022, Acc: 0.6646, AUC: 0.6961, F1: 0.7580
  ✓ 新的最佳模型 (AUC: 0.6961)
----------------------------------------------------------------------
Epoch 8/20
  Train - Loss: 0.6036, Acc: 0.6632, AUC: 0.6940, F1: 0.7599
  Val   - Loss: 0.6030, Acc: 0.6645, AUC: 0.6956, F1: 0.7592
----------------------------------------------------------------------
Epoch 9/20
  Train - Loss: 0.6033, Acc: 0.6633, AUC: 0.6942, F1: 0.7598
  Val   - Loss: 0.6032, Acc: 0.6647, AUC: 0.6956, F1: 0.7567
----------------------------------------------------------------------
Epoch 10/20
  Train - Loss: 0.6031, Acc: 0.6636, AUC: 0.6947, F1: 0.7603
  Val   - Loss: 0.6034, Acc: 0.6642, AUC: 0.6959, F1: 0.7556
----------------------------------------------------------------------
Epoch 11/20
  Train - Loss: 0.6029, Acc: 0.6638, AUC: 0.6948, F1: 0.7603
  Val   - Loss: 0.6052, Acc: 0.6650, AUC: 0.6956, F1: 0.7612
----------------------------------------------------------------------
Epoch 12/20
  Train - Loss: 0.6021, Acc: 0.6644, AUC: 0.6960, F1: 0.7606
  Val   - Loss: 0.6025, Acc: 0.6646, AUC: 0.6961, F1: 0.7588
  早停触发，停止训练

最佳验证集AUC: 0.6961

======================================================================
保存模型
======================================================================
已保存模型: models/transformer_model.pth
已保存数据处理器: models/transformer_processor.joblib

======================================================================
训练完成！
======================================================================
最佳验证集AUC: 0.6961

接下来运行: python3 generate_transformer_submission.py
